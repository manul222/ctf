import gdb

BINDIR="/home/mn1/ctf/2021/meta/rev/revvy_chevy_dir"
BIN="revvy_chevy"
INPUT="in.txt"
BREAK="0x00005555555552ba"

with open(INPUT, "w") as f:
    f.write("A"*0x40)

gdb.execute('file {}/{}'.format(BINDIR, BIN))
gdb.execute('break *{}'.format(BREAK))
gdb.execute('run < {}'.format(INPUT))

flag_enc = [ 0x74, 0x1a, 0x95, 0x4e, 0xba, 0xdb, 0x47, 0x64, 0x09, 0x2d, 0xd1, 0xbf, 0x8a, 0x9d, 0xde, 0x5a, 0xd7, 0x5c, 0x93, 0x16, 0x09, 0x3b, 0x30, 0x6f, 0x97, 0x40, 0xd0, 0x7c, 0x57, 0xdb, 0xde, 0x0c, 0x09, 0xa0, 0x84, 0x9b, 0x8a, 0x76, 0x2f, 0xb1, 0x57, 0xa2, 0xe1, 0x4f, 0xb9, 0x6f, 0x81, 0xbf, 0xb9, 0xbf, 0xe1, 0xef, 0x79, 0xcf, 0x01, 0xdf, 0xf9, 0x9f, 0xe1, 0x8f, 0x39, 0x2f, 0x81, 0xff, 0x00 ]
keys = []

for i in range(0x40):
    keys.append(int(gdb.parse_and_eval('$al').format_string(), 16))
    gdb.execute('c')


flag = ""
for i, key in enumerate(keys):
    c = chr(flag_enc[i] ^ key)
    flag = flag + c
    if c == "}":
        break

print(flag)

gdb.execute('quit')